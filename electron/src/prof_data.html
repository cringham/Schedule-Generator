<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CPSC Department Schedule Generator</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body>
    <div class="header">
      <h1><a href="index.html">CPSC Department Schedule Generator</a></h1>
    </div>
    <h1><a href="schedule.html"><img class="icon" src="images/back_arrow_icon.png" width="25px" height="25px" style="vertical-align: text-top;"></a>Persistent Professor Data</h1>

    <button class="btn" id="Save"><i class="fa fa-save"></i> Save</button>

    <table id="ProfessorTable">
      
    </table>
  <script> window.$ = window.jQuery = require('jquery') </script>

  <script src="generateProfessorTable.js" type="text/javascript"></script>

  <script type="text/javascript">
    $('#Save').click(function() {
        var mysql = require("mysql");
        var connection = mysql.createConnection({
            host: "localhost",
            user: "root",
            password: "",
            database: "scheduleDB",
            multiplestatements: true 
          });

        connection.connect((err) => {
          if (err){
            return console.log(err.stack);
            }
          console.log("Connection successful")
         });

        var table = [];
        $("#ProfessorTable tr").each(function() {
            var arrayOfThisRow = [];
            var tableData = $(this).find('td');
            if (tableData.length > 0) {
                tableData.each(function() { arrayOfThisRow.push($(this).text()); });
                arrayOfThisRow.push(arrayOfThisRow.shift());
                table.push(arrayOfThisRow);
            }
        });
        
        var queries = "";

        //console.log(table)

        table.forEach(function (item) {
            console.log(item)
            query = mysql.format("UPDATE professorData SET phone=?, office=?, email=? WHERE name=?",item);
            
            connection.query(query, function (err, result) {
              if (err) throw err;
              console.log("Number of records inserted: " + result.affectedRows);
            });
          });
        /*connection.query(queries, function (err, result) {
              if (err) throw err;
              console.log("Number of records inserted: " + result.affectedRows);
            });
            */
    });

  </script>
  </body>
</html>
